/**/﻿_jsload&&_jsload('glcommon', 'function f6(e,i){this.origin=e||null;this.direction=i||null}eP.extend(f6.prototype,{set:function(e,i){this.origin=e;this.direction=i}});dL.Ray=f6;function hD(jX,e,j3){j3=j3||{};var i=j3.filter||jX.LINEAR;var j1=j3.format||jX.RGBA;var j0=j3.type||jX.UNSIGNED_BYTE;var T=j3.wrap||jX.CLAMP_TO_EDGE;var jW=j3.mipmap||false;var jY=j3.testError||false;var jV=j3.unpackAlpha||false;var j2;if(typeof j3.flipY!=="boolean"){j2=true}else{j2=j3.flipY}var jZ=jX.createTexture();jX.bindTexture(jX.TEXTURE_2D,jZ);jX.pixelStorei(jX.UNPACK_FLIP_Y_WEBGL,j2);if(jV){jX.pixelStorei(jX.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true)}jX.texParameteri(jX.TEXTURE_2D,jX.TEXTURE_WRAP_S,T);jX.texParameteri(jX.TEXTURE_2D,jX.TEXTURE_WRAP_T,T);jX.texParameteri(jX.TEXTURE_2D,jX.TEXTURE_MAG_FILTER,i);jX.texParameteri(jX.TEXTURE_2D,jX.TEXTURE_MIN_FILTER,jW?jX.LINEAR_MIPMAP_LINEAR:i);if(e===null){jX.texImage2D(jX.TEXTURE_2D,0,j1,j3.width,j3.height,0,j1,j0,null)}else{jX.texImage2D(jX.TEXTURE_2D,0,j1,j1,j0,e)}if(jW){jX.generateMipmap(jX.TEXTURE_2D)}if(jY===true){if(jX.getError()===jX.INVALID_VALUE){return null}}return jZ}dL.utils={createTexture:hD};function bt(i,e){this._gl=i;e=e||{};this._ids={};this._count=0;this._width=e.width||4096;this._height=e.height||4096;this._name=e.name||"";this._textureType=e.textureType||i.UNSIGNED_BYTE;this._unpackAlpha=e.unpackAlpha||false;this._texture=null;this._currentOffsetY=0;this._currentX=0;this._nextX=0;this._usage=0;this.guid=bw.getGUID("texture_atlas_");this.isRendering=false;this._textTextureCache=[];if(e.init===true){this.initTexture()}}eP.extend(bt.prototype,{initTexture:function(){var e=this._gl;this._texture=dL.utils.createTexture(e,null,{type:this._textureType,width:this._width,height:this._height,unpackAlpha:this._unpackAlpha})},getTexture:function(){if(!this._texture){this.initTexture()}return this._texture},getSize:function(){return new iL(this._width,this._height)},addTexture:function(i,e){if(i.id&&this._ids[i.id]){return this._ids[i.id]}if(!this._texture){this.initTexture()}e=e||i.height;var jX=this._height-i.height-this._currentOffsetY;if(jX<0){this._currentX=this._nextX;this._currentOffsetY=0;jX=this._height-i.height;if(this._currentX>=this._width){return null}}if(i.width>(this._nextX-this._currentX)){this._nextX=this._currentX+i.width;if(this._nextX>this._width){return null}}var jW=this._gl;jW.bindTexture(jW.TEXTURE_2D,this._texture);jW.pixelStorei(jW.UNPACK_FLIP_Y_WEBGL,true);jW.texSubImage2D(jW.TEXTURE_2D,0,this._currentX,jX,jW.RGBA,this._textureType,i);var jV=this._currentOffsetY;this._currentOffsetY+=e;this._calcUsage();this._count++;var T={width:this._currentX/this._width,height:(this._height-jV-e)/this._height};this._ids[i.id]=T;return T},updateTexture:function(T,e){if(!this._texture||!T.id||!this._ids[T.id]){return this.addTexture(T,e)}var jW=this._ids[T.id];e=e||T.height;var jX=jW.height*this._height;var i=jW.width*this._width;var jV=this._gl;jV.bindTexture(jV.TEXTURE_2D,this._texture);jV.pixelStorei(jV.UNPACK_FLIP_Y_WEBGL,true);jV.texSubImage2D(jV.TEXTURE_2D,0,i,jX,jV.RGBA,this._textureType,T);return jW},_calcUsage:function(){this._usage=(this._currentX*this._height+(this._nextX-this._currentX)*this._currentOffsetY)/(this._height*this._width)},getUsage:function(){return this._usage},clear:function(){this._currentOffsetY=0;this._currentX=0;this._nextX=0;this._count=0;this._usage=0;this._ids={}}});dL.TextureAtlas=bt;function dJ(i,e){this._gl=i;e=e||{};this._textureWidth=e.width||4096;this._textureHeight=e.height||4096;this._name=e.name||"";this._unpackAlpha=e.unpackAlpha||false;this._textureCollection=[]}eP.extend(dJ.prototype,{getEmptyTexture:function(){var e=null;if(this._textureCollection.length<3){e=new bt(this._gl,{width:this._textureWidth,height:this._textureHeight,name:this._name,unpackAlpha:this._unpackAlpha});this._textureCollection.push(e)}else{e=this._textureCollection.shift();while(e.inUse===true){this._textureCollection.push(e);e=this._textureCollection.shift()}e.clear();this._textureCollection.push(e)}e.inUse=true;return e},free:function(e){e.inUse=false}});dL.TextTextureManager=dJ;var gb={instances:{},get:function(e,i){if(!i){throw"必须指定id"}if(!gb.instances[i]){gb.instances[i]=new id(e)}return gb.instances[i]},remove:function(e){if(gb.instances[e]){delete gb.instances[e]}}};function id(e){this._gl=e;this._attributes=new Uint8Array(16);this._enabledAttributes=new Uint8Array(16);this._capabilities={depthTest:[-1,this._gl.DEPTH_TEST],blend:[-1,this._gl.BLEND],cullFace:[-1,this._gl.CULL_FACE],stencilTest:[-1,this._gl.STENCIL_TEST],scissorTest:[-1,this._gl.SCISSOR_TEST]};this._faceCulling=-1;this._depthMask=-1;this._blendFunc=[-1,-1,-1,-1];this._colorMask=[-1,-1,-1,-1];this._depthFunc=-1;this._frontFace=-1;this._activeTexture=-1;this._clearColor=[0,0,0,0];this._fail=-1;this._zfail=-1;this._zpass=-1}eP.extend(id.prototype,{initAttribute:function(){for(var T=0,e=this._attributes.length;T<e;T++){this._attributes[T]=0}},enableAttribute:function(e){this._attributes[e]=1;if(this._enabledAttributes[e]===0){this._gl.enableVertexAttribArray(e);this._enabledAttributes[e]=1}},disableUnusedAttributes:function(){for(var T=0,e=this._enabledAttributes.length;T<e;T++){if(this._enabledAttributes[T]!==this._attributes[T]){this._gl.disableVertexAttribArray(T);this._enabledAttributes[T]=0}}},enableCap:function(e){if(this._capabilities[e][0]!==true){this._gl.enable(this._capabilities[e][1]);this._capabilities[e][0]=true}},disableCap:function(e){if(this._capabilities[e][0]!==false){this._gl.disable(this._capabilities[e][1]);this._capabilities[e][0]=false}},cullFace:function(e){if(this._faceCulling!==e){this._gl.cullFace(e);this._faceCulling=e}},blendFunc:function(){var i=arguments;var e=this._blendFunc;if(i.length===2){if(i[0]!==e[0]||i[1]!==e[1]||i[0]!==e[2]||i[1]!==e[3]){e[0]=i[0];e[1]=i[1];e[2]=i[0];e[3]=i[1];this._gl.blendFunc.apply(this._gl,arguments)}}else{if(i.length===4){if(i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]){e[0]=i[0];e[1]=i[1];e[2]=i[2];e[3]=i[3];this._gl.blendFuncSeparate.apply(this._gl,arguments)}}}},colorMask:function(){var e=arguments;var jV=true;for(var T=0;T<e.length;T++){if(this._colorMask[T]!==e[T]){this._colorMask[T]=e[T];jV=false}}if(!jV){this._gl.colorMask.apply(this._gl,arguments)}},depthFunc:function(e){if(this._depthFunc!==e){this._depthFunc=e;this._gl.depthFunc(e)}},depthMask:function(e){if(this._depthMask!==e){this._gl.depthMask(e);this._depthMask=e}},frontFace:function(e){if(this._frontFace!==e){this._frontFace=e;this._gl.frontFace(e)}},activeTexture:function(e){if(this._activeTexture!==e){this._activeTexture=e;this._gl.activeTexture(e)}},clearColor:function(e){if(!e||e.length<4){return}if(this._clearColor[0]!==e[0]||this._clearColor[1]!==e[1]||this._clearColor[2]!==e[2]||this._clearColor[3]!==e[3]){this._clearColor=e.slice(0,4);this._gl.clearColor(e[0]/255,e[1]/255,e[2]/255,e[3]/255)}},stencilOp:function(i,T,e){if(this._fail!==i||this._zfail!==T||this._zpass!==e){this._fail=i;this._zfail=T;this._zpass=e;this._gl.stencilOp(i,T,e)}}});dL.WebGLState=gb;');
